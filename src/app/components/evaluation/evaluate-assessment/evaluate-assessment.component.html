<h1 class="text-blue-800 text-3xl text-center font-semibold mb-6">{{clickedData?.title}}</h1>

<!-- Marks Scored section -->
<div class="flex justify-end text-blue-800 text-xl font-semibold mb-6">
  Marks Scored: <span class="text-green-600">{{clickedData?.marksScored || 0}} / {{clickedData.totalMarks || 0}}</span>
</div>

<div class="w-full max-w-5xl mx-auto p-4"> <!-- Full-width container with max width and auto margins -->

  <!-- Loop through each question -->
  @for(question of clickedData.questions; track question.question_id) {
    
    <div class="mt-6 p-6 border-2 border-blue-800 rounded-lg flex justify-between items-start">
      <div class="flex flex-col w-full">
        <!-- Question Text -->
        <div class="text-blue-700 text-lg font-semibold mb-4">{{question.question_text}}</div>
        
        <!-- Marks for each question -->
        <div class="text-right text-blue-600 text-sm">
          Marks: <span class="text-green-600">{{question.marksScored || 0}} / {{question.totalMarks || 0}}</span>
        </div>
        
        <!-- Single-answer question -->
        @if (question.question_type == "single_answer") {
          <div class="space-y-3">
            @for(option of question.options; track option) {
              <div class="flex items-center">
                <input 
                  type="radio" 
                  id="{{question.question_id}}-{{option}}" 
                  name="{{question.question_id}}" 
                  class="cursor-pointer" 
                  [checked]="question.user_answer === option" 
                  disabled
                  [class.bg-green-500]="question.user_answer === option && option === question.correct_answer"
                  [class.bg-red-500]="question.user_answer === option && option !== question.correct_answer"
                  [class.bg-yellow-500]="question.user_answer === undefined && option !== question.correct_answer">
                <label for="{{question.question_id}}-{{option}}" class="ml-2">
                  <span [class.text-green-500]="question.user_answer === option && option === question.correct_answer"
                        [class.text-red-500]="question.user_answer === option && option !== question.correct_answer"
                        [class.text-yellow-500]="question.user_answer === undefined && option !== question.correct_answer">
                    {{option}}
                  </span>
                </label>
              </div>
            }
          </div>
        }
        
        <!-- Multi-answer question -->
        @else if (question.question_type == "multi_answer") {
          <div class="space-y-3">
            @for(option of question.options; track option) {
              <div class="flex items-center">
                <input 
                  type="checkbox" 
                  id="{{question.question_id}}-{{option}}" 
                  class="cursor-pointer"
                  [checked]="question.user_answer.includes(option)" 
                  disabled
                  [class.bg-green-500]="question.user_answer.includes(option) && question.correct_answers.includes(option)"
                  [class.bg-red-500]="question.user_answer.includes(option) && !question.correct_answers.includes(option)"
                  [class.bg-yellow-500]="!question.user_answer.includes(option) && question.correct_answers.includes(option)">
                <label for="{{question.question_id}}-{{option}}" class="ml-2">
                  <span [class.text-green-500]="question.user_answer.includes(option) && question.correct_answers.includes(option)"
                        [class.text-red-500]="question.user_answer.includes(option) && !question.correct_answers.includes(option)"
                        [class.text-yellow-500]="!question.user_answer.includes(option) && question.correct_answers.includes(option)">
                    {{option}}
                  </span>
                </label>
              </div>
            }
          </div>
        }

        <!-- Descriptive question -->
        @else if (question.question_type == "descriptive") {
          <div>
            <div class="mb-4">
              <label for="userAnswer" class="block text-blue-700">User's Answer:</label>
              <textarea id="userAnswer" 
                        class="w-full p-3 border-2 border-blue-800 rounded-md bg-gray-100 text-black" 
                        [value]="question.user_answer" readonly></textarea>
            </div>
            <div>
              <label for="marks" class="block text-blue-700">Assign Marks:</label>
              <input id="marks" type="number" 
                     class="w-full p-3 border-2 border-blue-800 rounded-md bg-white text-black" 
                     [(ngModel)]="question.assigned_marks" 
                     placeholder="Enter marks" 
                     max="5" min="0"
                     [disabled]="clickedData.marksScored"> <!-- Disable input if marksScored is present -->
            </div>
          </div>
        }
      </div>
    </div>
    
  }
</div>

<div class="text-center m-6">
  <app-button
    [label]="clickedData.marksScored ? 'Close' : 'Complete Evaluation'" 
    [colorClass]="clickedData.marksScored ? 'px-8 py-3 text-white bg-gray-500 border-2 border-blue-800 rounded-md transition-all duration-300 hover:bg-gray-600' : 'px-8 py-3 text-white bg-blue-600 border-2 border-blue-800 rounded-md transition-all duration-300 hover:bg-blue-700'" 
    (click)="onSubmit()">
  </app-button>
</div>
